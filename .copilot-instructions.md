# Copilot Instructions for TikTok Clone NestJS Project

> **Auto-loaded by GitHub Copilot** - This file provides context for all AI interactions in this workspace.

## ğŸ—ï¸ Project Architecture

This is a **NestJS Monorepo** with microservices architecture:

- **Services**: api-gateway, auth-service, video-service, interaction-service, notification-service
- **Shared Libs**: `@app/common`, `@app/database`, `@app/redis`, `@app/kafka`, `@app/grpc`
- **Frontend**: Next.js 14 TypeScript in `tiktok-frontend/`
- **Communication**: gRPC between services, REST for client APIs

## ğŸ“‹ Code Generation Rules

### Always Follow These Conventions:

1. **Naming**:
   - Files: `kebab-case.ts`
   - Classes: `PascalCase`
   - Methods/Variables: `camelCase`
   - Constants: `UPPER_SNAKE_CASE`
   - Interfaces: `IPascalCase`

2. **TypeScript**:
   - âœ… Use strict typing, avoid `any`
   - âœ… Use async/await (not promises)
   - âœ… Use optional chaining (`?.`) and nullish coalescing (`??`)
   - âœ… Return type annotations on all methods

3. **NestJS Patterns**:
   - âœ… Use `@Injectable()` for services
   - âœ… Dependency injection via constructor
   - âœ… Use DTOs with class-validator decorators
   - âœ… Add Swagger decorators (`@ApiTags()`, `@ApiOperation()`)
   - âœ… Proper error handling with NestJS exceptions

4. **Imports**:
   - âœ… Use path aliases: `@app/common`, `@app/database`, etc.
   - âŒ Don't use relative paths for shared libs

5. **Structure**:
   ```
   module/
   â”œâ”€â”€ dto/
   â”‚   â”œâ”€â”€ create-*.dto.ts
   â”‚   â””â”€â”€ update-*.dto.ts
   â”œâ”€â”€ entities/
   â”‚   â””â”€â”€ *.entity.ts
   â”œâ”€â”€ *.controller.ts
   â”œâ”€â”€ *.service.ts
   â”œâ”€â”€ *.module.ts
   â””â”€â”€ *.spec.ts
   ```

## ğŸš« Anti-Patterns - Never Do This:

```typescript
// âŒ No 'any' types
const data: any = ...

// âŒ No business logic in controllers
@Post()
async create(@Body() dto: CreateDto) {
  const hashed = await bcrypt.hash(dto.password, 10);
  return this.repo.save({ ...dto, password: hashed });
}

// âŒ No hardcoded values
const dbHost = 'localhost';

// âŒ No sync operations
const data = fs.readFileSync(...);

// âŒ Don't bypass shared libraries
const redis = new Redis(); // Use @app/redis instead
```

## âœ… Correct Patterns:

### Service Example
```typescript
import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { User } from './entities/user.entity';

@Injectable()
export class UserService {
  constructor(
    @InjectRepository(User)
    private readonly userRepository: Repository<User>,
  ) {}

  async findById(id: string): Promise<User> {
    const user = await this.userRepository.findOne({ where: { id } });
    if (!user) {
      throw new NotFoundException(`User with ID ${id} not found`);
    }
    return user;
  }
}
```

### Controller Example
```typescript
import { Controller, Get, Post, Body, Param } from '@nestjs/common';
import { ApiTags, ApiOperation } from '@nestjs/swagger';

@ApiTags('users')
@Controller('users')
export class UserController {
  constructor(private readonly userService: UserService) {}

  @Get(':id')
  @ApiOperation({ summary: 'Get user by ID' })
  async getUser(@Param('id') id: string) {
    return this.userService.findById(id);
  }
}
```

### DTO Example
```typescript
import { IsString, IsEmail, IsNotEmpty, MinLength } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

export class CreateUserDto {
  @ApiProperty({ example: 'john@example.com' })
  @IsEmail()
  @IsNotEmpty()
  email: string;

  @ApiProperty({ example: 'SecurePass123', minLength: 8 })
  @IsString()
  @MinLength(8)
  password: string;
}
```

## ğŸ“ Commit Message Format

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Types**: feat, fix, refactor, docs, test, style, perf, chore
**Scopes**: auth, video, interaction, notification, gateway, database, redis, frontend

## ğŸ¯ When Generating Code:

1. **Check existing patterns** in similar files first
2. **Use shared libraries** instead of recreating functionality
3. **Follow the service structure** already established
4. **Include proper validation** with DTOs
5. **Add error handling** with appropriate NestJS exceptions
6. **Include Swagger docs** for all endpoints
7. **Write tests** for new functionality
8. **Use TypeScript strict typing** throughout

## ğŸ“š Reference Files:

- Service: `apps/auth-service/src/auth.service.ts`
- Controller: `apps/auth-service/src/auth.controller.ts`
- Module: `apps/auth-service/src/auth.module.ts`
- Full Guide: `AI_PROMPT_GUIDE.md`

## ğŸ¯ Quality Checklist:

Before generating code, ensure:
- [ ] Follows existing file structure
- [ ] Uses proper TypeScript types
- [ ] Includes validation decorators
- [ ] Has error handling
- [ ] Uses shared libraries via path aliases
- [ ] Includes Swagger documentation
- [ ] Follows naming conventions
- [ ] No hardcoded values
- [ ] No 'any' types
- [ ] Async/await for async operations
