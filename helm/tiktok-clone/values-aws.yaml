# AWS EKS Environment Values
# Optimized for ~$199/month budget with SPOT instances

global:
  environment: production
  domain: '' # Set your domain or leave empty
  imagePullPolicy: Always
  imagePullSecrets:
    - name: ghcr-secret

# Namespace
namespace: tiktok-clone-prod

# =============================================================================
# Infrastructure (Disabled - Using separate Helm releases via Terraform)
# =============================================================================
postgresql:
  enabled: false
  # Connection will be set via ConfigMap/Secrets

redis:
  enabled: false
  # Connection will be set via ConfigMap/Secrets

kafka:
  enabled: false
  # Connection will be set via ConfigMap/Secrets

# =============================================================================
# Services Configuration - Using GHCR Images
# =============================================================================
services:
  # Auth Service
  auth:
    name: auth-service
    replicas: 2
    image:
      repository: ghcr.io/betuanminh22032003/tiktok_nestjs/auth-service
      tag: latest
    port: 4001
    grpcPort: 50051
    resources:
      requests:
        memory: '128Mi'
        cpu: '100m'
      limits:
        memory: '256Mi'
        cpu: '250m'
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 80

  # Video Service
  video:
    name: video-service
    replicas: 2
    image:
      repository: ghcr.io/betuanminh22032003/tiktok_nestjs/video-service
      tag: latest
    port: 4002
    grpcPort: 50052
    resources:
      requests:
        memory: '128Mi'
        cpu: '100m'
      limits:
        memory: '256Mi'
        cpu: '250m'
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 80

  # Interaction Service
  interaction:
    name: interaction-service
    replicas: 2
    image:
      repository: ghcr.io/betuanminh22032003/tiktok_nestjs/interaction-service
      tag: latest
    port: 4003
    grpcPort: 50053
    resources:
      requests:
        memory: '128Mi'
        cpu: '100m'
      limits:
        memory: '256Mi'
        cpu: '250m'
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 80

  # Notification Service
  notification:
    name: notification-service
    replicas: 2
    image:
      repository: ghcr.io/betuanminh22032003/tiktok_nestjs/notification-service
      tag: latest
    port: 4004
    grpcPort: 50054
    resources:
      requests:
        memory: '128Mi'
        cpu: '100m'
      limits:
        memory: '256Mi'
        cpu: '250m'
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 80

  # API Gateway
  gateway:
    name: api-gateway
    replicas: 2
    image:
      repository: ghcr.io/betuanminh22032003/tiktok_nestjs/api-gateway
      tag: latest
    port: 4000
    serviceType: ClusterIP # ALB will handle external traffic
    resources:
      requests:
        memory: '128Mi'
        cpu: '100m'
      limits:
        memory: '256Mi'
        cpu: '250m'
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 4
      targetCPUUtilizationPercentage: 75

# =============================================================================
# Ingress - AWS ALB
# =============================================================================
ingress:
  enabled: true
  className: alb
  ingressClassName: alb
  host: '' # Leave empty for ALB DNS, or set your domain

  annotations:
    kubernetes.io/ingress.class: alb

  aws:
    enabled: true
    scheme: internet-facing
    targetType: ip
    healthcheckPath: /health
    certificateArn: '' # Add ACM cert ARN for HTTPS

# =============================================================================
# Monitoring - Minimal for cost saving
# =============================================================================
monitoring:
  enabled: true
  prometheus:
    enabled: true
    resources:
      requests:
        memory: '256Mi'
        cpu: '100m'
      limits:
        memory: '512Mi'
        cpu: '250m'
  grafana:
    enabled: true
    resources:
      requests:
        memory: '128Mi'
        cpu: '50m'
      limits:
        memory: '256Mi'
        cpu: '150m'
  elasticsearch:
    enabled: true
    resources:
      requests:
        memory: '512Mi'
        cpu: '250m'
      limits:
        memory: '1Gi'
        cpu: '500m'
  alertmanager:
    enabled: false # Disabled to save resources
  loki:
    enabled: false # Use CloudWatch instead
  promtail:
    enabled: false

# =============================================================================
# Migration & Seeding
# =============================================================================
migration:
  enabled: true
  targetService: all
  forceSync: false
  backoffLimit: 3

seeding:
  enabled: false # Enable only for fresh deployment
